<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#ff3b1a" />
    <title>Ryuuda — Profile</title>
    <meta name="description" content="Your Ryuuda Dashboard Profile" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      :root {
        --bg0: #07060a;
        --bg1: #0a0810;
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.7);
        --line: rgba(255, 255, 255, 0.1);
        --fire1: #ff2a1a;
        --fire2: #ff6a00;
        --fire3: #ffd000;
        --shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
        --radius: 18px;
        --max: 1120px;
        --discord-blurple: #5865F2;
        --discord-green: #57F287;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial;
        color: var(--text);
        background: radial-gradient(
            900px 520px at 18% 10%,
            rgba(255, 106, 0, 0.14),
            transparent 60%
          ),
          radial-gradient(
            900px 520px at 80% 28%,
            rgba(255, 42, 26, 0.12),
            transparent 62%
          ),
          radial-gradient(
            900px 520px at 50% 92%,
            rgba(255, 208, 0, 0.08),
            transparent 58%
          ),
          linear-gradient(180deg, var(--bg1), var(--bg0));
        overflow-x: hidden;
      }
      a {
        color: inherit;
        text-decoration: none;
      }
      .wrap {
        max-width: var(--max);
        margin: 0 auto;
        padding: 22px 18px 70px;
      }
      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 14px 16px;
        border: 1px solid var(--line);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.06),
          rgba(255, 255, 255, 0.03)
        );
        border-radius: 999px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 14px;
        z-index: 10;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 20px;
      }
      .brandName {
        font-weight: 750;
        letter-spacing: 0.2px;
      }
      .logoPH {
        width: 34px;
        height: 34px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: radial-gradient(
          circle at 30% 30%,
          rgba(255, 208, 0, 0.22),
          rgba(255, 106, 0, 0.16),
          rgba(255, 42, 26, 0.1)
        );
        box-shadow: 0 18px 38px rgba(255, 70, 20, 0.18);
        overflow: hidden;
      }
      .links {
        display: flex;
        align-items: center;
        gap: 18px;
        color: var(--muted);
        font-size: 13px;
      }
      .links a {
        padding: 10px 10px;
        border-radius: 999px;
        border: 1px solid transparent;
        transition: 0.12s ease;
      }
      .links a:hover {
        color: var(--text);
        border-color: rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.04);
      }
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 18px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.04);
        font-weight: 700;
        font-size: 13px;
        transition: all 0.18s ease;
        white-space: nowrap;
        cursor: pointer;
        color: var(--text);
      }
      .btn:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.22);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      }
      .btn.primary {
        border-color: rgba(255, 106, 0, 0.55);
        background: linear-gradient(
          135deg,
          rgba(255, 42, 26, 0.95),
          rgba(255, 106, 0, 0.95)
        );
        box-shadow: 0 16px 44px rgba(255, 60, 20, 0.2);
      }
      .btn.primary:hover {
        filter: saturate(1.06);
        box-shadow: 0 20px 50px rgba(255, 60, 20, 0.3);
      }
      .btn.discord {
        border-color: rgba(255, 106, 0, 0.4);
        background: linear-gradient(
          135deg,
          rgba(255, 42, 26, 0.95),
          rgba(255, 106, 0, 0.95)
        );
        color: white;
        box-shadow: 0 16px 44px rgba(255, 60, 20, 0.2);
      }
      .btn.discord:hover {
        border-color: rgba(255, 106, 0, 0.6);
        background: linear-gradient(
          135deg,
          rgba(255, 42, 26, 1),
          rgba(255, 106, 0, 1)
        );
        box-shadow: 0 20px 50px rgba(255, 60, 20, 0.3);
      }
      .btn.logout {
        border-color: rgba(255, 80, 80, 0.4);
        background: linear-gradient(
          135deg,
          rgba(255, 80, 80, 0.95),
          rgba(255, 120, 120, 0.95)
        );
        color: white;
        box-shadow: 0 16px 44px rgba(255, 80, 80, 0.2);
      }
      .btn.logout:hover {
        border-color: rgba(255, 80, 80, 0.6);
        background: linear-gradient(
          135deg,
          rgba(255, 80, 80, 1),
          rgba(255, 120, 120, 1)
        );
        box-shadow: 0 20px 50px rgba(255, 80, 80, 0.3);
      }
      /* Profile-specific styles */
      .profile-hero {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 32px;
        margin-top: 22px;
        padding: 60px 20px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
        border-radius: var(--radius);
        border: 1px solid var(--line);
        box-shadow: var(--shadow);
      }
      .profile-avatar {
        width: 140px;
        height: 140px;
        border-radius: 50%;
        border: 3px solid rgba(255, 255, 255, 0.2);
        background: var(--bg1);
        overflow: hidden;
        position: relative;
      }
      .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .profile-avatar.default {
        background: linear-gradient(135deg, var(--fire1), var(--fire2));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 48px;
      }
      .profile-info {
        text-align: center;
        gap: 12px;
        display: flex;
        flex-direction: column;
      }
      .profile-name {
        font-size: 36px;
        font-weight: 850;
        line-height: 1.1;
        margin: 0;
      }
      .profile-tag {
        font-size: 18px;
        color: var(--muted);
        margin: 4px 0 0;
      }
      .profile-email {
        font-size: 16px;
        color: var(--text);
        opacity: 0.8;
      }
      .profile-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 24px;
      }
      .not-logged-in {
        text-align: center;
        padding: 60px 20px;
      }
      .not-logged-in h2 {
        font-size: 28px;
        margin-bottom: 16px;
        color: var(--muted);
      }
      .footer {
        margin-top: 18px;
        padding-top: 16px;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        color: var(--muted);
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
      }
      @media (max-width: 740px) {
        .profile-name { font-size: 28px; }
        .profile-avatar { width: 100px; height: 100px; font-size: 36px; }
        .links { display: none; }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header class="nav">
        <div class="brand">
          <div class="logoPH" aria-hidden="true"></div>
          <div class="brandName">Ryuuda</div>
        </div>
        <nav class="links" aria-label="Navigation">
          <a href="../terms-of-service/index.html">Terms-of-Service</a>
          <a href="../privacy-policy/index.html">Privacy-Policy</a>
        </nav>
        <div id="auth-button-container">
          <!-- Dynamically filled by JavaScript -->
        </div>
      </header>
      <main id="profile-content">
        <!-- Dynamically filled by JavaScript -->
      </main>
      <footer class="footer">
        <div>© <span id="y"></span> Ryuuda & *R2U: Ready to use</div>
      </footer>
    </div>
    <script>
      document.getElementById("y").textContent = new Date().getFullYear();

      // Expose auth globally for event handlers
      window.auth = null;

      // Discord Implicit Grant Configuration (client-side safe)
      const DISCORD_CONFIG = {
        clientId: '1456640479201595453',
        redirectUri: 'https://ryuuda.vercel.app', // Matches your exact URL (no trailing /)
        scope: 'identify email',
        responseType: 'token', // Implicit flow: token direct in hash
      };

      class DiscordAuth {
        constructor(containerId = 'auth-button-container', contentId = 'profile-content') {
          this.user = null;
          this.accessToken = null;
          this.containerId = containerId;
          this.contentId = contentId;
          this.init();
        }

        async init() {
          // Parse URL hash for access_token on callback
          this.parseCallback();

          // Check for stored token
          await this.checkAuth();

          this.renderAuthButton();
          this.renderProfileContent();
          window.auth = this; // Global reference
        }

        parseCallback() {
          if (window.location.hash) {
            const hash = window.location.hash.substring(1); // Remove #
            const params = new URLSearchParams(hash);
            this.accessToken = params.get('access_token');
            const tokenType = params.get('token_type');
            const expiresIn = params.get('expires_in');

            if (this.accessToken && tokenType === 'Bearer') {
              // Store token
              sessionStorage.setItem('discord_access_token', this.accessToken);
              sessionStorage.setItem('discord_token_expires', Date.now() + (parseInt(expiresIn) * 1000));

              // Clean URL (remove hash)
              window.history.replaceState({}, document.title, window.location.pathname);

              // Fetch user info
              this.fetchUserInfo();
            } else {
              // Handle error
              const error = params.get('error');
              const errorDesc = params.get('error_description');
              if (error) {
                console.error('OAuth Error:', error, errorDesc);
              }
            }
          }
        }

        async checkAuth() {
          const storedToken = sessionStorage.getItem('discord_access_token');
          const expires = sessionStorage.getItem('discord_token_expires');

          if (storedToken && expires && Date.now() < parseInt(expires)) {
            this.accessToken = storedToken;
            await this.fetchUserInfo();
          } else {
            this.clearAuth();
          }
        }

        async fetchUserInfo() {
          if (!this.accessToken) return;

          try {
            const response = await fetch('https://discord.com/api/users/@me', {
              headers: {
                'Authorization': `Bearer ${this.accessToken}`,
              },
            });

            if (response.ok) {
              this.user = await response.json();
            } else {
              console.error('Failed to fetch user info:', response.status);
              this.clearAuth();
            }
          } catch (error) {
            console.error('Auth check error:', error);
            this.clearAuth();
          }
        }

        login() {
          const params = new URLSearchParams({
            client_id: DISCORD_CONFIG.clientId,
            redirect_uri: DISCORD_CONFIG.redirectUri,
            response_type: DISCORD_CONFIG.responseType,
            scope: DISCORD_CONFIG.scope,
          });

          const authUrl = `https://discord.com/oauth2/authorize?${params.toString()}`;
          window.location.href = authUrl;
        }

        logout() {
          this.clearAuth();
          this.renderAuthButton();
          this.renderProfileContent();
          window.location.hash = ''; // Clear any lingering hash
        }

        clearAuth() {
          this.user = null;
          this.accessToken = null;
          sessionStorage.removeItem('discord_access_token');
          sessionStorage.removeItem('discord_token_expires');
        }

        getAvatarUrl(userId, avatarHash) {
          if (!avatarHash) return null;
          return `https://cdn.discordapp.com/avatars/${userId}/${avatarHash}.png?size=256`;
        }

        renderAuthButton() {
          const container = document.getElementById(this.containerId);
         
          if (this.user) {
            const avatarUrl = this.getAvatarUrl(this.user.id, this.user.avatar);
            const displayName = this.user.global_name || this.user.username;
            const discriminator = this.user.discriminator && this.user.discriminator !== '0'
              ? `#${this.user.discriminator}`
              : '';
           
            container.innerHTML = `
              <div class="user-dropdown">
                <div class="user-profile">
                  <div class="user-avatar ${avatarUrl ? '' : 'default'}">
                    ${avatarUrl
                      ? `<img src="${avatarUrl}" alt="${displayName}" onerror="this.style.display='none';this.parentElement.classList.add('default');this.parentElement.textContent='${displayName.charAt(0).toUpperCase()}'">`
                      : displayName.charAt(0).toUpperCase()
                    }
                  </div>
                  <div class="user-info">
                    <span class="user-name">${displayName}</span>
                    ${discriminator ? `<span class="user-discriminator">${discriminator}</span>` : ''}
                  </div>
                  <i class="fas fa-chevron-down" style="font-size: 12px; opacity: 0.6;"></i>
                </div>
                <div class="dropdown-menu">
                  <div class="dropdown-header">
                    <div class="user-name">${displayName}</div>
                    ${this.user.email ? `<div class="user-email">${this.user.email}</div>` : ''}
                  </div>
                  <div class="dropdown-item" id="view-profile-btn">
                    <i class="fas fa-user"></i>
                    <span>View Profile</span>
                  </div>
                  <div class="dropdown-divider"></div>
                  <div class="dropdown-item logout" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Log Out</span>
                  </div>
                </div>
              </div>
            `;

            // Event listeners
            document.getElementById('view-profile-btn').addEventListener('click', () => {
              window.open(`https://discord.com/users/${this.user.id}`, '_blank');
            });
            document.getElementById('logout-btn').addEventListener('click', () => {
              this.logout();
            });

          } else {
            container.innerHTML = `
              <button class="btn discord" id="login-btn">
                <i class="fab fa-discord"></i>
                Login with Discord
              </button>
            `;

            document.getElementById('login-btn').addEventListener('click', () => {
              this.login();
            });
          }
        }

        renderProfileContent() {
          const content = document.getElementById(this.contentId);
          if (this.user) {
            const avatarUrl = this.getAvatarUrl(this.user.id, this.user.avatar);
            const displayName = this.user.global_name || this.user.username;
            const discriminator = this.user.discriminator && this.user.discriminator !== '0' ? `#${this.user.discriminator}` : '';
            content.innerHTML = `
              <section class="profile-hero">
                <div class="profile-avatar ${avatarUrl ? '' : 'default'}">
                  ${avatarUrl ? `<img src="${avatarUrl}" alt="${displayName}" onerror="this.style.display='none';this.parentElement.classList.add('default');this.parentElement.textContent='${displayName.charAt(0).toUpperCase()}'">` : displayName.charAt(0).toUpperCase()}
                </div>
                <div class="profile-info">
                  <h1 class="profile-name">${displayName}</h1>
                  <div class="profile-tag">${discriminator}</div>
                  ${this.user.email ? `<div class="profile-email">${this.user.email}</div>` : ''}
                </div>
                <div class="profile-actions">
                  <a class="btn primary" href="../">
                    <i class="fas fa-home"></i> Back to Home
                  </a>
                  <button class="btn logout" onclick="auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> Log Out
                  </button>
                </div>
              </section>
            `;
          } else {
            content.innerHTML = `
              <section class="not-logged-in">
                <h2><i class="fas fa-user-circle"></i> Log in to view your profile</h2>
                <p style="color: var(--muted);">You're not signed in yet. Login to access your dashboard profile.</p>
                <button class="btn discord" onclick="auth.login()">
                  <i class="fab fa-discord"></i> Login with Discord
                </button>
                <div style="margin-top: 20px;">
                  <a href="../" class="btn" style="background: transparent;">
                    <i class="fas fa-arrow-left"></i> Go Home
                  </a>
                </div>
              </section>
            `;
          }
        }
      }

      // Initialize
      const authInstance = new DiscordAuth();

      // Multi-tab sync
      window.addEventListener('storage', (e) => {
        if (e.key && e.key.startsWith('discord_')) {
          location.reload();
        }
      });
    </script>
  </body>
</html>
